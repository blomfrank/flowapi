openapi: 3.0.0
servers:
  - description: Ontwikkel server
    url: 'https://teamplatform-ontwikkel.azurewebsites.net/data/iris'
info:
  description: This is the REST API for Flow
  version: 1.0.0
  title: Flow REST API
  contact:
    email: support@kubion.nl
tags:
  - name: Instance
  - name: Flow
  - name: Table
  - name: Type
paths:
  '/flow//instance/{code}/init':
    parameters:
      - schema:
          type: string
        name: code
        in: path
        description: The code of the flow that should be started.
        required: true
    post:
      operationId: createandstartflow
      summary: Create and start a new session
      tags:
        - Instance
      parameters:
        - in: query
          name: dev
          schema:
            type: boolean
          required: false
          description: If this is a development (test) session
        - in: query
          name: debug
          schema:
            type: boolean
          required: false
          description: If debug info should be included in the response
        - schema:
            type: string
          in: header
          name: Authorization
          description: Contains the token received with the operation /auth. This is needed to get access.
          required: true
      responses:
        '200':
          description: Flow initialized successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FLOWResult'
              examples:
                example:
                  value:
                    elements:
                      - type: display
                        data:
                          text: |-
                            Coordineer de oplossing en kies de juiste bewaking.
                            Wat moet er met de klacht gebeuren?
                      - type: select
                        data:
                          outputKey: choice
                          list:
                            - value: 0
                              text: Spoedeisend (<2 werkdagen)
                            - value: 1
                              text: Normaal (<10 werkdagen)
                            - value: 2
                              text: Klacht afwijzen
                    _requireComment: false
                    ID: 1425
                    debug:
                      - id: 3k8itoecmyl4efp9
                        state:
                          ruimte: slaapkamer
                          element: kraan
                        activeNode:
                          id: 7
                          label: Beoordelen klacht
                          trace:
                            completedLabel: Klacht beoordeeld
                          deadline:
                            duration: PT8H
                            nodeId: 0
                          handler:
                            handlerId: 1014
                          actions:
                            - data:
                                name: Ask_question
                                stateObj:
                                  question: |-
                                    Coordineer de oplossing en kies de juiste bewaking.
                                    Wat moet er met de klacht gebeuren?
                                  options:
                                    - text: Spoedeisend (<2 werkdagen)
                                      type: transition
                                      value: 11
                                    - text: Normaal (<10 werkdagen)
                                      type: transition
                                      value: 12
                                    - text: Klacht afwijzen
                                      type: transition
                                      value: 13
                                configObj: {}
                                outputKey: ''
                        code: Klachten
                        trace:
                          - 7
                      - id: ipfjn4lh7fi12d0-
                        state:
                          question: |-
                            Coordineer de oplossing en kies de juiste bewaking.
                            Wat moet er met de klacht gebeuren?
                          options:
                            - text: Spoedeisend (<2 werkdagen)
                              type: transition
                              value: 11
                            - text: Normaal (<10 werkdagen)
                              type: transition
                              value: 12
                            - text: Klacht afwijzen
                              type: transition
                              value: 13
                        activeNode:
                          id: 1
                          label: Start
                          actions:
                            - data:
                                elements:
                                  - type: display
                                    data:
                                      $text: question
                                  - type: select
                                    data:
                                      outputKey: choice
                                      $list: 'options.map((option, index) => ({value: index, text: option.text}))'
                                $_requireComment: '(state._requireComment !== undefined ? state._requireComment : false)'
                            - data:
                                stateObj: {}
                                configObj: {}
                                outputKey: ''
                                $name: 'options[choice].value'
                              conditionText: "options[choice].type == 'flow'"
                            - data:
                                $nodeId: 'options[choice].value'
                              conditionText: "options[choice].type == 'transition'"
                            - data:
                                output: ''
                        code: Ask_question
                        trace:
                          - 1
                    deadline: false
        '404':
          description: There is no flow with code ...
      requestBody:
        description: Key/value pairs that will be put into flow state
        content:
          application/json:
            schema:
              type: object
              additionalProperties:
                type: string
            examples:
              example:
                value:
                  ruimte: slaapkamer
                  element: kraan
      description: This operation creates a flow and will start it immediately.
  '/flow/instance/{id}/continue':
    post:
      summary: Continue/advance an existing session
      tags:
        - Instance
      parameters:
        - in: query
          name: debug
          schema:
            type: boolean
          required: false
          description: If debug info should be included in the response
        - schema:
            type: string
          in: header
          name: Authorization
          description: Contains the token received with the operation /auth. This is needed to get access.
          required: true
      responses:
        '200':
          description: Flow advanced successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FLOWResult'
              examples:
                example:
                  value:
                    elements:
                      - type: display
                        data:
                          text: |-
                            Coordineer de oplossing en kies de juiste bewaking.
                            Wat moet er met de klacht gebeuren?
                      - type: select
                        data:
                          outputKey: choice
                          list:
                            - value: 0
                              text: Spoedeisend (<2 werkdagen)
                            - value: 1
                              text: Normaal (<10 werkdagen)
                            - value: 2
                              text: Klacht afwijzen
                    _requireComment: false
                    ID: 1425
                    debug:
                      - id: 3k8itoecmyl4efp9
                        state:
                          ruimte: slaapkamer
                          element: kraan
                        activeNode:
                          id: 7
                          label: Beoordelen klacht
                          trace:
                            completedLabel: Klacht beoordeeld
                          deadline:
                            duration: PT8H
                            nodeId: 0
                          handler:
                            handlerId: 1014
                          actions:
                            - data:
                                name: Ask_question
                                stateObj:
                                  question: |-
                                    Coordineer de oplossing en kies de juiste bewaking.
                                    Wat moet er met de klacht gebeuren?
                                  options:
                                    - text: Spoedeisend (<2 werkdagen)
                                      type: transition
                                      value: 11
                                    - text: Normaal (<10 werkdagen)
                                      type: transition
                                      value: 12
                                    - text: Klacht afwijzen
                                      type: transition
                                      value: 13
                                configObj: {}
                                outputKey: ''
                        code: Klachten
                        trace:
                          - 7
                      - id: ipfjn4lh7fi12d0-
                        state:
                          question: |-
                            Coordineer de oplossing en kies de juiste bewaking.
                            Wat moet er met de klacht gebeuren?
                          options:
                            - text: Spoedeisend (<2 werkdagen)
                              type: transition
                              value: 11
                            - text: Normaal (<10 werkdagen)
                              type: transition
                              value: 12
                            - text: Klacht afwijzen
                              type: transition
                              value: 13
                        activeNode:
                          id: 1
                          label: Start
                          actions:
                            - data:
                                elements:
                                  - type: display
                                    data:
                                      $text: question
                                  - type: select
                                    data:
                                      outputKey: choice
                                      $list: 'options.map((option, index) => ({value: index, text: option.text}))'
                                $_requireComment: '(state._requireComment !== undefined ? state._requireComment : false)'
                            - data:
                                stateObj: {}
                                configObj: {}
                                outputKey: ''
                                $name: 'options[choice].value'
                              conditionText: "options[choice].type == 'flow'"
                            - data:
                                $nodeId: 'options[choice].value'
                              conditionText: "options[choice].type == 'transition'"
                            - data:
                                output: ''
                        code: Ask_question
                        trace:
                          - 1
                    deadline: false
        '404':
          description: There is no session with id ...
      requestBody:
        description: Key/value pairs that will be put into flow state
        content:
          application/json:
            schema:
              type: object
            examples:
              example:
                value:
                  ruimte: slaapkamer
                  element: kraan
      description: This operation will ask flow to go the next step.
      operationId: ContinueFlow
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: This is the ID of the flow instance retrieved with the operation /init
  '/flow/instance/{id}/back':
    post:
      summary: Revert an existing session to the previous step
      tags:
        - Instance
      parameters:
        - in: query
          name: debug
          schema:
            type: boolean
          required: false
          description: If debug info should be included in the response
      responses:
        '200':
          description: Flow reverted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FLOWResult'
        '404':
          description: There is no session with id ...
      operationId: GoBackinFlow
      description: |
        Goes one step back in the flow. Does an undo on the current step.
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
  /auth:
    parameters: []
    post:
      tags:
        - Instance
      summary: ''
      operationId: post-Auth
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      ID:
                        type: integer
                        description: The ID of the user that requested a new token
                      fullName:
                        type: string
                        description: The fullname of the user that requested a new token
                      profileImage:
                        type: string
                        description: The url of the image of the user that requested a new token
                      language:
                        type: string
                        description: The default language of the user that requested a new token
                    required:
                      - ID
                      - fullName
                      - profileImage
                      - language
                  token:
                    type: string
                    description: The token that can be used to do new requests
                  refreshToken:
                    type: string
                required:
                  - token
              examples:
                example:
                  value:
                    user:
                      ID: 2078
                      fullName: Eline de Groot
                      profileImage: ../publishedMedia/d8c3d988096c26f20e1bb6b73bc4beef.jpeg
                      language: nl
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjA3OCwibmFtZSI6IkVsaW5lIGRlIEdyb290IiwiZXh0ZXJuSUQiOiIyMDc4IiwiaWF0IjoxNTkyMDQyMTkxLCJleHAiOjE1OTIwNDU3OTF9.rLKXWgYc30zlFSkDly2H1wXoPl_GJiXbDjQklaOZZFc
                    refreshToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjA3OCwibmFtZSI6IkVsaW5lIGRlIEdyb290IiwiaWF0IjoxNTkyMDQyMTkxLCJleHAiOjE1OTIxMjg1OTF9.QHNm4Mfx3vJB6s7n5YiT8DgSeIkZcv_QXGrqZd9Nf34
        '500':
          description: Internal Server Error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                loginName:
                  type: string
                password:
                  type: string
                  format: password
            examples:
              example:
                value:
                  loginName: eline.de.groot@woonplezier.nu
                  password: xxxxxxxx
          application/xml:
            schema:
              type: object
              properties: {}
        description: The request body should contain the loginname and password of the user that requests a new token.
      description: With this operation a token can be requested.
      parameters:
        - schema:
            type: string
          in: header
          name: Content-Type
          description: application/json
components:
  schemas:
    FLOWResult:
      type: object
      description: Description of the current state of a flow
      x-examples:
        example:
          elements:
            - type: display
              data:
                text: |-
                  Coordineer de oplossing en kies de juiste bewaking.
                  Wat moet er met de klacht gebeuren?
            - type: select
              data:
                outputKey: choice
                list:
                  - value: 0
                    text: Spoedeisend (<2 werkdagen)
                  - value: 1
                    text: Normaal (<10 werkdagen)
                  - value: 2
                    text: Klacht afwijzen
          _requireComment: false
          ID: 1425
          debug:
            - id: 3k8itoecmyl4efp9
              state:
                ruimte: slaapkamer
                element: kraan
              activeNode:
                id: 7
                label: Beoordelen klacht
                trace:
                  completedLabel: Klacht beoordeeld
                deadline:
                  duration: PT8H
                  nodeId: 0
                handler:
                  handlerId: 1014
                actions:
                  - data:
                      name: Ask_question
                      stateObj:
                        question: |-
                          Coordineer de oplossing en kies de juiste bewaking.
                          Wat moet er met de klacht gebeuren?
                        options:
                          - text: Spoedeisend (<2 werkdagen)
                            type: transition
                            value: 11
                          - text: Normaal (<10 werkdagen)
                            type: transition
                            value: 12
                          - text: Klacht afwijzen
                            type: transition
                            value: 13
                      configObj: {}
                      outputKey: ''
              code: Klachten
              trace:
                - 7
            - id: ipfjn4lh7fi12d0-
              state:
                question: |-
                  Coordineer de oplossing en kies de juiste bewaking.
                  Wat moet er met de klacht gebeuren?
                options:
                  - text: Spoedeisend (<2 werkdagen)
                    type: transition
                    value: 11
                  - text: Normaal (<10 werkdagen)
                    type: transition
                    value: 12
                  - text: Klacht afwijzen
                    type: transition
                    value: 13
              activeNode:
                id: 1
                label: Start
                actions:
                  - data:
                      elements:
                        - type: display
                          data:
                            $text: question
                        - type: select
                          data:
                            outputKey: choice
                            $list: 'options.map((option, index) => ({value: index, text: option.text}))'
                      $_requireComment: '(state._requireComment !== undefined ? state._requireComment : false)'
                  - data:
                      stateObj: {}
                      configObj: {}
                      outputKey: ''
                      $name: 'options[choice].value'
                    conditionText: "options[choice].type == 'flow'"
                  - data:
                      $nodeId: 'options[choice].value'
                    conditionText: "options[choice].type == 'transition'"
                  - data:
                      output: ''
              code: Ask_question
              trace:
                - 1
          deadline: false
      properties:
        ID:
          type: integer
          example: 3824
          description: This is the ID of the instance of the flow. This ID is needed in a fllowing request to be able to continue to the next step.
        debug:
          type: object
          minProperties: 0
          description: Shows debug information about the current state of the flow
          properties:
            id:
              type: string
              example: 12p89urdio4
            state:
              type: object
            activeNode:
              type: object
              example: {"4"}
              properties:
                id:
                  type: integer
                label:
                  type: string
                trace:
                  type: string
                deadline:
                  type: object
                  properties:
                    duration:
                      type: string
                    nodeId:
                      type: string
                actions:
                  type: array
                  items:
                    type: object
            code:
              type: string
              example: Klachten_afhandelen
            trace:
              type: array
              items:
                type: integer
                example:
        elements:
          type: array
          description: Elements are the elements connected to the current node.
          minItems: 0
          maxItems: 20
          items:
            type: object
            properties:
              type:
                type: string
                enum:
                  - display
                  - select
                  - input
                  - link
                  - remote-select
              data:
                anyOf:
                  - $ref: '#/components/schemas/ElementSelect'
                  - $ref: '#/components/schemas/ElementDisplay'
                  - $ref: '#/components/schemas/ElementInput'
                  - $ref: '#/components/schemas/ElementLink'
                  - $ref: '#/components/schemas/ElementRemoteSelect'
        deadline:
          type: boolean
        _requireComment:
          type: boolean
      required:
        - ID
        - elements
    ElementSelect:
      title: ElementSelect
      type: object
      properties:
        List:
          type: array
          items:
            type: object
            properties:
              value:
                type: string
              text:
                type: string
        outputKey:
          type: string
      x-examples:
        example:
          outputKey: choice
          list:
            - value: 0
              text: Spoedeisend (<2 werkdagen)
            - value: 1
              text: Normaal (<10 werkdagen)
            - value: 2
              text: Klacht afwijzen
    ElementDisplay:
      title: ElementDisplay
      type: object
      x-examples:
        example:
          text: |-
            Coordineer de oplossing en kies de juiste bewaking.
            Wat moet er met de klacht gebeuren?
      properties:
        text:
          type: string
    ElementInput:
      title: ElementInput
      type: object
      properties:
        outputKey:
          type: string
        required:
          type: boolean
        pattern:
          type: string
    ElementLink:
      title: ElementLink
      type: object
      properties:
        url:
          type: string
        text:
          type: string
        target:
          type: string
    ElementRemoteSelect:
      title: ElementRemoteSelect
      type: object
      properties:
        query:
          type: string
        outputKey:
          type: string
        required:
          type: boolean
  securitySchemes: {}
